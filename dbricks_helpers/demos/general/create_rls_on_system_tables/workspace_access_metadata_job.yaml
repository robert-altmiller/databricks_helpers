resources:
  jobs:
    workspace_access_metadata:
      name: workspace_access_metadata
      tasks:
        - task_key: get_workspace_users_and_admins
          notebook_task:
            notebook_path: /Workspace/Users/robert.altmiller@databricks.com/workspace_access_metadata_step1
            base_parameters:
              iam_catalog: MY_CATALOG
              iam_schema: MY_SCHEMA
            source: WORKSPACE
          existing_cluster_id: 0602-172109-8fb9oxd
        - task_key: iterate_system_tables
          depends_on:
            - task_key: get_workspace_users_and_admins
          for_each_task:
            inputs: '["system.access.assistant_events", "system.access.audit",
              "system.access.column_lineage",   "system.access.outbound_network",
              "system.access.table_lineage",
              "system.access.workspaces_latest",  "system.compute.clusters",
              "system.compute.node_timeline",
              "system.compute.warehouse_events",  "system.compute.warehouses",
              "system.lakeflow.job_run_timeline",
              "system.lakeflow.job_task_run_timeline",  "system.lakeflow.job_tasks",
              "system.lakeflow.jobs",
              "system.query.history",  "system.serving.served_entities",
              "system.storage.predictive_optimization_operations_history",  "system.billing.usage"]'
            concurrency: 10
            task:
              task_key: create_system_table_views
              notebook_task:
                notebook_path: /Workspace/Users/robert.altmiller@databricks.com/workspace_access_metadata_step2
                base_parameters:
                  system_table: "{{input}}"
                  iam_catalog: datamesh_sandbox_roadshow_demo_dev_azr_westus
                  iam_schema: datamesh_iam_schema
                source: WORKSPACE
              existing_cluster_id: 0602-172109-8fb9oxd
      queue:
        enabled: true
